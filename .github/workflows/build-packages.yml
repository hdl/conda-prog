name: build-packages
on:
  push:
    # Prevents triggering multiple workflows in PRs. Workflows triggered from
    # the same commit shouldn't run simultaneously because they're overwriting
    # each other's packages on Anaconda.
    #    branches: [ master ]
    paths-ignore:
      - '.github/workflows/tuttest.yml'
      - 'README.md'
  pull_request:
    paths-ignore:
      - '.github/workflows/tuttest.yml'
      - 'README.md'
  workflow_dispatch:
  schedule:
    - cron: '0 1 * * *' # run daily at 1:00am (UTC)
env:
  ANACONDA_TOKEN: ${{ secrets.ANACONDA_TOKEN }}
  ANACONDA_USER: ${{ secrets.ANACONDA_USER }}
  NUM_OF_JOBS: 24
defaults:
  run:
    shell: bash
jobs:
  #21
  libusb-windows:
    runs-on: "windows-2019"
    env:
      PACKAGE: "lib/usb"
      OS_NAME: "windows"
    steps:
      - uses: actions/checkout@v2
      - uses: hdl/conda-ci@master

  #22
  libhidapi-windows:
    runs-on: "windows-2019"
    needs: "libusb-windows"
    env:
      PACKAGE: "lib/hidapi"
      OS_NAME: "windows"
    steps:
      - uses: actions/checkout@v2
      - uses: hdl/conda-ci@master

  #23
  libftdi-windows:
    runs-on: "windows-2019"
    needs: "libusb-windows"
    env:
      PACKAGE: "lib/ftdi"
      OS_NAME: "windows"
    steps:
      - uses: actions/checkout@v2
      - uses: hdl/conda-ci@master

  #24
  iceprog-windows:
    runs-on: "windows-2019"
    needs: ["libusb-windows", "libftdi-windows"]
    env:
      PACKAGE: "tools/iceprog"
      OS_NAME: "windows"
    steps:
      - uses: actions/checkout@v2
      - uses: hdl/conda-ci@master
